<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Search Bookmarked Pages</title>

<link rel="shortcut icon" href="logo.png"> 
<link rel="stylesheet" type="text/css" href="style.css"/>

<script type="text/javascript" src="jquery-1.4.4.min.js"></script>

<script language="Javascript">
// SearchMarkUI.html: SearchMark front-end
//
// Copyright (C) 2010  Candy Yiu, and Akshay Dua
//
// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.

// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program.  If not, see <http://www.gnu.org/licenses/>.

// About:
// Initialize communication channel between backend and UI.
// No UI code should be added here. Change only if ABSOLUTELY 
// necessary.
//

$(document).ready(
    function() 
    {
        // Listen for search results from backend
        chrome.extension.onConnect.addListener(function(port) {
            if(port.name != "uiToBackend") {
                console.log("Invalid port name: " + port.name);
                return;
            }
            
            port.onMessage.addListener(function(result) {
                processSearchResult(result);
            });
        });
        
        $('#searchbox').focus();
    });

// Send request to backend for displaying a cached bookmark page
function requestCachedPage(id) {
    chrome.extension.sendRequest(
        {method: 'cached', bookmarkid: id}, 
        function() {});
}

// Take keywords from text box and send to
// backend for searching.
function startSearch() {
    searchkey = $('#searchbox').value;

    chrome.extension.sendRequest(
        {method: 'search', keywords: searchkey}, 
        function() {});
}

// Each search result will be delivered here.
// result object has fields,
//   result.url: page URL
//   result.text: formatted page text, or URL
//   result.title: page title
//   result.matchType: 'title', 'url', or 'page'
//     If the title matched, then result.text will be 
//     empty. if URL matched, then result.text will be 
//     a formatted URL (keyword is in bold face), if 
//     page text matched, then result.text will contain 
//     textual context.
function processSearchResult(result) {
    if(result.matchType == "DONE") {
        resultString = "Search done.";
        document.searchForm.elements['searchBox'].focus();
    } else {
        resultString = 
        '<span class="ContentTitle">' + result.title +'</span>'
        + '<img src="space.png" width="15" height="1" id="space">'
        + '<br/>';
        if(result.text != ""){
            resultString += '<span class="ContentText">' + result.text + '</span><br/>';
        }

        resultString += '<span class="ContentURL"><a class="ContentURL" href="' +
        result.url + '">' + result.url + '</a></span>';

        resultString += '<input type="button" onclick="requestCachedPage('
            + result.id + ');" value="Stored Version"/>';
    }

    p = document.createElement("p");
    p.innerHTML = resultString;

    searchResultID = document.getElementById("searchResult");
    searchResultID.appendChild(p);
    //document.body.appendChild(p);
}

</script>
</head>

<body>
    
  <!-- Moves content vertically down to the center-->
<div id="floater"></div>

<div id="welcomesearchui">

  <!-- logo image -->
  <img src="images/hand-written-name.png" alt="SearchMark Logo and
                                               Name"/>
  <!-- spacing -->
  <p>&nbsp;

  <!-- search box -->
  <input type="text" id="searchbox" class="searchbox"/>

  <!-- search button -->
  <button type="button" id="searchbutton" class="searchbutton"
  onmousedown="$('#searchbutton').addClass('searchbuttonpressed')"
  onmouseup="$('#searchbutton').removeClass('searchbuttonpressed')">Search</button>

</div>

</body>
</html>


